var apiService={};apiService.defaultTranslator={ERR_NOTCONNECTED:"Not connected\nPlease check your network connection or server CORS's OPTION response.",ERR_PARSERERROR:"Requested JSON parse failed",ERR_TIMEOUT:"Time out error",ERR_ABORT:"Ajax request aborted",REQ_ERROR:"Error requesting",CLOSE:"Close"},apiService.init=function(e,r,i){"/"===e.slice(-1)&&(e=e.substr(0,e.length-1)),apiService.ServerURL=e,apiService.ClientCSRF=r,void 0!==i&&(apiService.Translator=i),apiService.ErrorLookup=null,apiService.AjaxCache={},apiService.NonceKeyName="apiservice_"+apiService.ServerURL+"_nonce_key"},apiService.Alert=function(e){var r=apiService.transMessage("REQ_ERROR");(null===bootbox||"object"!=typeof bootbox)&&alert(r+"\r\n"+e),bootbox.dialog({message:"<PRE>"+e+"</PRE>",title:r,buttons:{danger:{label:apiService.transMessage("CLOSE"),className:"btn-danger",callback:function(){}}}})},apiService.transMessage=function(e){return void 0!==apiService.Translator&&void 0!==apiService.Translator[e]?apiService.Translator[e]:void 0!==apiService.defaultTranslator[e]?apiService.defaultTranslator[e]:e},apiService.SetErrorLookup=function(e){apiService.ErrorLookup=e},apiService.GetAjaxErrorMessage=function(e,r,i){var a,t;if(t=void 0===e||void 0===e.status?600:e.status,0===e.status)a=apiService.transMessage("ERR_NOTCONNECTED");else if("parsererror"===i)a=apiService.transMessage("ERR_PARSERERROR");else if("timeout"===i)a=apiService.transMessage("ERR_TIMEOUT");else if("abort"===i)a=apiService.transMessage("ERR_ABORT");else{var o;void 0!==e.responseText&&(o=e.responseText),a=!1,"function"==typeof apiService.ErrorLookup&&(a=apiService.ErrorLookup(e.status,o)),"string"!=typeof a&&(a=e.status+" "+o)}var c=[];"string"==typeof a&&c.push(a);var n=e.responseJSON;if(void 0!==n&&null!=n)if(n.constructor==Array)for(var s=0;s<n.length;s++)c.push(n[s]);else{var p=String(n);""!=p&&c.push(p)}return c},apiService.cbServiceAjaxError=function(e,r,i,a){for(var t=apiService.GetAjaxErrorMessage(r,i,a),o="",c=0;c<t.length;c++)o+="    "+t[c]+"\r\n";apiService.Alert(o)},apiService.GetCachedRequest=function(e,r,i,a){var t=e+"?"+JSON.stringify(r);return void 0!==apiService.AjaxCache[t]?void i(apiService.AjaxCache[t]):void apiService.SendRequest("GET",e,r,function(e){apiService.AjaxCache[t]=e,i(e)},a)},apiService.BuildURL=function(e){return url=apiService.ServerURL,"/"!==e.charAt(0)&&(url+="/"),url+=e,url+="?_csrf="+apiService.ClientCSRF,url},apiService.SendRequest=function(e,r,i,a,t,o){url=apiService.ServerURL,"/"!==r.charAt(0)&&(url+="/"),url+=r,apiService.lastURL=url;var c=t;"function"!=typeof c&&(c=function(e,r,i){apiService.cbServiceAjaxError(url,e,r,i)});var n=a;"function"!=typeof n&&(n=null);var s=e.toUpperCase(),p={url:url,type:s,dataType:"json",success:n,error:c,xhrFields:{withCredentials:!0},headers:{"X-CSRF-Token":apiService.ClientCSRF}};if("GET"!=s&&(p.headers["X-Nonce"]=apiService.getNonce()),void 0!==o&&o){var v=$(i);v.is("form")?p.data=new FormData(v[0]):p.data=i,p.cache=!1,p.processData=!1,p.contentType=!1}else{var S=apiService.checkSendAsForm(s,i);p.data=S.data,S.isFormData?p.contentType="application/x-www-form-urlencoded; charset=utf-8":p.contentType="application/json; charset=utf-8",p.cache="GET"==s}$.ajax(p)},apiService.getNonceInfo=function(){return void 0===apiService.NonceKeyString?"":apiService.NonceKeyString.substr(0,4)+"..."+apiService.NonceKeyString.slice(-4)},apiService.getNonce=function(){var e=apiService.NonceKeyName+"_prev",r=localStorage.getItem(e);(void 0===r||isNaN(e))&&(r=0);for(var i=(new Date).getTime();i==r;)i++;if(localStorage.setItem(e,i),(void 0===apiService.NonceKey||null==apiService.NonceKey)&&(apiService.NonceKeyString=localStorage.getItem(apiService.NonceKeyName),apiService.NonceKey=CryptoJS.enc.Hex.parse(apiService.NonceKeyString)),void 0===apiService.NonceJWTHeader){var a={alg:"HS256",typ:"JWT"};apiService.NonceJWTHeader=apiService.base64url(CryptoJS.enc.Utf8.parse(JSON.stringify(a)))}var t=apiService.NonceJWTHeader+"."+apiService.base64url(CryptoJS.enc.Utf8.parse(JSON.stringify({dta:{key:i}})));return t+"."+apiService.base64url(CryptoJS.HmacSHA256(t,apiService.NonceKey))},apiService.base64url=function(e){return encodedSource=CryptoJS.enc.Base64.stringify(e),encodedSource=encodedSource.replace(/=+$/,""),encodedSource=encodedSource.replace(/\+/g,"-"),encodedSource=encodedSource.replace(/\//g,"_"),encodedSource},apiService.checkSendAsForm=function(e,r){if("object"!=typeof r||null===r)return{isFormData:!0,data:r};var i=$(r);return i.is("form")?{isFormData:!0,data:i.serialize()}:"GET"==e?{isFormData:!0,data:r}:{isFormData:!1,data:JSON.stringify(r)}},apiService.parseLinkHeader=function(e){var r=e.getResponseHeader("Link");if(null==r||""==r)return{};for(var i=r.split(","),a={},t=0;t<i.length;t++){var o=i[t].split(";");if(2===o.length){var c=o[0].replace(/<(.*)>/,"$1").trim(),n=o[1].replace(/rel="(.*)"/,"$1").trim();a[n]=c}}return a},apiService.logout=function(e){var r=$("<form>",{action:apiService.ServerURL+"/auth/logout",method:"post"});r.append($("<input>",{type:"hidden",name:"_tk",value:e})),$("body").append(r),r.submit()},apiService.getFieldValue=function(e,r){if(void 0===e||null===e)return null;for(var i=e,a=r.split("."),t=0;t<a.length;t++){if("object"!=typeof e||null===i)return null;if(i=i[a[t]],void 0===i)return null}return i};