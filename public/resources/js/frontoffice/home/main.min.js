var srvMain={cache:{},init:function(a){$.extend(!0,$.fn.dataTable.defaults,{dom:"t",iDisplayLength:200,language:g_dataTablesTranslator}),srvMain.translator=a,srvMain.waterlevelInit=!0,srvMain.waterlevelCache=[],srvMain.currentDatatable=null,srvMain.initVar(),srvMain.initMap(),srvMain.initFilter(),srvMain.initLoad(),$(document).on("click",'a[data-toggle="modal-rain"]',function(a){return a.preventDefault(),$("#modal-rain").find("iframe").attr("src","iframe/graph/rain24?station="+$(this).attr("href")),$("#modal-rain").modal(),!1}),$(document).on("click",'a[data-toggle="modal-waterlevel"]',function(a){return a.preventDefault(),$("#modal-rain").find("iframe").attr("src","iframe/graph/waterlevel?station="+$(this).attr("href")),$("#modal-rain").modal(),!1}),$(document).on("click",'a[data-toggle="modal-dam"]',function(a){return a.preventDefault(),$("#modal-dam").find("iframe").attr("src","iframe/graph/dam?dam="+$(this).attr("href")),$("#modal-dam").modal(),!1}),$(document).on("click",'a[data-toggle="modal-waterquality"]',function(a){return a.preventDefault(),$("#modal-waterquality").find("iframe").attr("src","iframe/graph/waterquality?station="+$(this).attr("href")),$("#modal-waterquality").modal(),!1}),$(".carousel").carousel({interval:!1}),$("#modal-prerain").on("show.bs.modal",function(a){var e=$(a.relatedTarget);$(this).find("ul.nav.nav-tabs li:eq("+Number(e.attr("data-tab"))+") a").tab("show"),$(this).find(".carousel").carousel(Number(e.attr("data-slide-to")))}),$("#modal-prewave").on("show.bs.modal",function(a){var e=$(a.relatedTarget);$(this).find(".carousel").carousel(Number(e.attr("data-slide-to")))}),$("#modal-prerain-tmd").on("show.bs.modal",function(a){var e=$(a.relatedTarget);$("#modal-prerain-tmd-carousel").carousel(Number(e.attr("data-slide-to")))}),$("#modal-prerain_animation").on("shown.bs.modal",function(){$("#modal-prerain_animation").find("ul.nav.nav-tabs li:eq(0) a").tab("show"),srvMain.PlayVideoAtStart("modal-prerain_animation")}),$('#modal-prerain_animation a[data-toggle="tab"]').on("shown.bs.tab",function(a){srvMain.PlayVideoAtStart("modal-prerain_animation")})},PlayVideoAtStart:function(a){var e=$("#"+a).find(".tab-pane.in.active").find("video")[0];e.currentTime=0,e.paused&&e.play()},initVar:function(){srvMain.service="thaiwater30/public/thailand_main",srvMain.Marker=function(a){return{fillColor:a,radius:8,color:"#4c4c4c",weight:1,opacity:.8,fillOpacity:1,clickable:!0}},$("#div_waterlevel_table , #div_waterquality_table").css("max-height","780px"),srvMain.Rain_Table=$("#rain_table"),srvMain.Rain_DataTable=srvMain.Rain_Table.DataTable({fixedHeader:!0,columns:[{data:srvMain.Rain_render_name},{data:srvMain.Rain_render_location},{data:srvMain.Rain_render_time},{data:srvMain.Rain_render_rain}],order:[[3,"desc"]],language:{emptyTable:srvMain.translator.rain_empty_table}}),srvMain.WaterLevel_Table=$("#waterlevel_table"),srvMain.WaterLevel_DataTable=srvMain.WaterLevel_Table.DataTable({fixedHeader:!0,order:[[1,"asc"]],columns:[{data:srvMain.WaterLevel_render_basin,width:"0",visible:!1},{data:srvMain.WaterLevel_render_basinId,width:"0",visible:!1},{data:srvMain.WaterLevel_render_name,width:"112px"},{data:srvMain.WaterLevel_render_datetime,width:"53px"},{data:srvMain.WaterLevel_render_msl,width:"45px"},{data:srvMain.WaterLevel_render_storage,width:"82px"},{data:srvMain.WaterLevel_render_situation,width:"48px"}],drawCallback:function(a){console.log(a);var e=this.api(),t=e.rows({page:"current"}).nodes(),r=null,n=srvMain.WaterLevel_Table.find("thead th").length;e.column(0,{page:"current"}).data().each(function(a,e){r!==a&&($(t).eq(e).before('<tr class="gr"><th colspan="'+n+'">'+a+"</th></tr>"),r=a)})}}),srvMain.WaterLevel_Table_OrderBasin_Current=[1,"asc"],srvMain.WaterLevel_Table_Order_Current=[],srvMain.WaterLevel_Table.on("click","thead th",function(){var a=srvMain.WaterLevel_DataTable.order()[srvMain.WaterLevel_DataTable.order().length-1],e=a[1];if(0!=srvMain.WaterLevel_Table_Order_Current.length){var t=srvMain.WaterLevel_Table_Order_Current[srvMain.WaterLevel_Table_Order_Current.length-1];t[0]==a[0]&&(e="asc"==t[1]?"desc":"asc")}srvMain.WaterLevel_Table_Order_Current=[srvMain.WaterLevel_Table_OrderBasin_Current,[a[0],e]],srvMain.WaterLevel_DataTable.order(srvMain.WaterLevel_Table_Order_Current).draw()}),$("#waterlevel_table tbody").on("click","tr.gr",function(){var a=srvMain.WaterLevel_DataTable.order()[0];1===a[0]&&"asc"===a[1]?srvMain.WaterLevel_Table_OrderBasin_Current=[1,"desc"]:srvMain.WaterLevel_Table_OrderBasin_Current=[1,"asc"],srvMain.WaterLevel_DataTable.order(srvMain.WaterLevel_Table_OrderBasin_Current).draw()}),srvMain.Dam_Table=$("#dam_table"),srvMain.Dam_DataTable=srvMain.Dam_Table.DataTable({fixedHeader:!0,columns:[{data:srvMain.Dam_render_name},{data:srvMain.Dam_render_inflow},{data:srvMain.Dam_render_storage,type:"dam"},{data:srvMain.Dam_render_uses_water,type:"dam"},{data:srvMain.Dam_render_release}],order:[[0,"asc"]]}),jQuery.fn.dataTableExt.oSort["dam-asc"]=function(a,e){return(a=numeral(a.split(" ")[0]).value())<(e=numeral(e.split(" ")[0]).value())?-1:a>e?1:0},jQuery.fn.dataTableExt.oSort["dam-desc"]=function(a,e){return(a=numeral(a.split(" ")[0]).value())<(e=numeral(e.split(" ")[0]).value())?1:a>e?-1:0},srvMain.WaterQuality_Table=$("#waterquality_table"),srvMain.WaterQuality_DataTable=srvMain.WaterQuality_Table.DataTable({fixedHeader:!0,columns:[{data:srvMain.WaterQuality_render_name},{data:srvMain.WaterQuality_render_province},{data:srvMain.WaterQuality_render_datetime},{data:srvMain.WaterQuality_render_salinity},{data:srvMain.WaterQuality_render_do},{data:srvMain.WaterQuality_render_ph},{data:srvMain.WaterQuality_render_turbid},{data:srvMain.WaterQuality_render_conductivity},{data:srvMain.WaterQuality_render_tds},{data:srvMain.WaterQuality_render_chlorophyll},{data:srvMain.WaterQuality_render_temp,visible:!1},{data:srvMain.WaterQuality_render_depth,visible:!1}],order:[[3,"desc"],[4,"desc"],[5,"desc"],[6,"desc"],[7,"desc"],[8,"desc"]]})},onEachFeature:function(a,e,t){void 0===srvMain.FEATURE_PROVINCE&&(srvMain.FEATURE_PROVINCE={}),void 0===srvMain.FEATURE_PROVINCE[a]&&(srvMain.FEATURE_PROVINCE[a]=[]),srvMain.FEATURE_PROVINCE[a][e.properties.prov_code]=t,srvMain.FEATURE_PROVINCE[a][e.properties.title]=t},onEachFeature_Rain:function(a,e){srvMain.onEachFeature("rain",a,e)},onEachFeature_WaterLevel:function(a,e){srvMain.onEachFeature("waterlevel",a,e)},initMap:function(){$("#rain_map").height("700px"),$("#dam_map").height("650px"),$("#waterlevel_map").height("750px"),$("#waterquality_map").height("750px"),srvMain.GEOJSON_THAILAND_STYLE={fillOpacity:0,opacity:0,interactive:!1},srvMain.GEOJSON_FOCUS_STYLE={opacity:1},srvMain.dam_map=LL.Map("dam_map"),srvMain.rain_map=LL.Map("rain_map"),L.geoJson(LL.GetGeoJsonThailand(),{style:srvMain.GEOJSON_THAILAND_STYLE,onEachFeature:srvMain.onEachFeature_Rain}).addTo(srvMain.rain_map),srvMain.waterlevel_map=LL.Map("waterlevel_map"),L.geoJson(LL.GetGeoJsonThailand(),{style:srvMain.GEOJSON_THAILAND_STYLE,onEachFeature:srvMain.onEachFeature_WaterLevel}).addTo(srvMain.waterlevel_map),srvMain.waterquality_map=LL.Map("waterquality_map")},initFilter:function(){$("#rain_filter_province").on("change",function(){var a=$(this).val(),e={province_code:a};apiService.GetCachedRequest(srvMain.service+"_rain",e,function(e){"OK"==e.result&&(srvMain.Rain_genTable(e.data),srvMain.Rain_genMap(e.data),""!=a?(void 0!==srvMain.current_rain&&srvMain.current_rain.setStyle(srvMain.GEOJSON_THAILAND_STYLE),srvMain.current_rain=srvMain.FEATURE_PROVINCE.rain[a],srvMain.current_rain.setStyle(srvMain.GEOJSON_FOCUS_STYLE),srvMain.rain_map.fitBounds(srvMain.current_rain.getBounds())):(LL.CenterDefault(srvMain.rain_map),void 0!==srvMain.current_rain&&(srvMain.current_rain.setStyle(srvMain.GEOJSON_THAILAND_STYLE),delete srvMain.current_rain)))})}),$("#waterlevel_filter_province").on("change",function(){var a=$(this).val(),e={province_code:a,order:$("#waterlevel_filter_sort").val()};""!=a?$("#waterlevel_filter_sort").hide().val("desc"):$("#waterlevel_filter_sort").show(),apiService.GetCachedRequest(srvMain.service+"_waterlevel",e,function(e){if("OK"==e.result)if(srvMain.waterlevelInit=!0,srvMain.waterlevelCache=[],srvMain.WaterLevel_genMap(e.data),""!=a){var t=srvMain.GetWaterLevel20("");srvMain.WaterLevel_genTable(t),void 0!==srvMain.current_waterlevel&&srvMain.current_waterlevel.setStyle(srvMain.GEOJSON_THAILAND_STYLE),srvMain.current_waterlevel=srvMain.FEATURE_PROVINCE.waterlevel[a],srvMain.current_waterlevel.setStyle(srvMain.GEOJSON_FOCUS_STYLE),srvMain.waterlevel_map.fitBounds(srvMain.current_waterlevel.getBounds())}else $("#waterlevel_filter_sort").trigger("change"),LL.CenterDefault(srvMain.waterlevel_map),void 0!==srvMain.current_waterlevel&&(srvMain.current_waterlevel.setStyle(srvMain.GEOJSON_THAILAND_STYLE),delete srvMain.current_waterlevel)})}),$("#waterlevel_filter_sort").on("change",function(){var a=$("#waterlevel_filter_sort").val(),e=srvMain.GetWaterLevel20(a);srvMain.WaterLevel_genTable(e)})},initLoad:function(){apiService.SendRequest("GET",srvMain.service,{},function(a){srvMain.handlerFilterProvince(JH.GetJsonValue(a,"province")),srvMain.handlerSrvRain(JH.GetJsonValue(a,"rain")),srvMain.handlerSrvRader(JH.GetJsonValue(a,"radar")),srvMain.handlerSrvWaterLevel(JH.GetJsonValue(a,"waterlevel")),srvMain.handlerSrvDam(JH.GetJsonValue(a,"dam")),srvMain.handlerSrvWaterQuality(JH.GetJsonValue(a,"waterquality")),srvMain.handlerSrvStorm(JH.GetJsonValue(a,"storm")),srvMain.handlerSrvPreRainTH(JH.GetJsonValue(a,"pre_rain")),srvMain.handlerSrvPreRainSea(JH.GetJsonValue(a,"pre_rain_sea")),srvMain.handlerSrvPreRainAsia(JH.GetJsonValue(a,"pre_rain_asia")),srvMain.handlerSrvPreRainBsin(JH.GetJsonValue(a,"pre_rain_basin")),srvMain.handlerSrvPreRainAnimation(JH.GetJsonValue(a,"pre_rain_animation")),srvMain.handlerSrvWave(JH.GetJsonValue(a,"wave")),srvMain.handlerSrvWaveAnimation(JH.GetJsonValue(a,"wave_animation")),srvMain.handlerSrvWarning(JH.GetJsonValue(a,"warning")),srvMain.handlerCurrentIcon(),$("#body").on("activate.bs.scrollspy",function(a){null!=srvMain.currentDatatable&&srvMain.currentDatatable.fixedHeader.disable();var e=null;switch($(a.target).find("a").attr("data-box")){case"rain":e=srvMain.Rain_DataTable;break;case"waterlevel":e=srvMain.WaterLevel_DataTable;break;case"dam":e=srvMain.Dam_DataTable;break;case"waterquality":e=srvMain.WaterQuality_DataTable}e&&e.fixedHeader.enable(),srvMain.currentDatatable=e})})},handlerCurrentIcon:function(){if(window.location.hash){var a=window.location.hash;setTimeout(function(){$("html,body").animate({scrollTop:$(a).offset().top}),$("body").scrollspy({target:"#body",offset:35}),$("body").each(function(){$(this).scrollspy("refresh")})},1e3)}else $("body").scrollspy({target:"#body",offset:35}),$("body").each(function(){$(this).scrollspy("refresh")})},handlerFilterProvince:function(a){if("OK"!=a.result)return!1;var e=a.data;JH.Sort(e,"province_name",!1,function(a){return JH.GetLangValue(a).toLowerCase()});var t=document.getElementById("rain_filter_province"),r=document.getElementById("waterlevel_filter_province");t.add(new Option(srvMain.translator.show_all_filter_province,"")),r.add(new Option(srvMain.translator.show_all_filter_province,""));for(var n in e)t.add(new Option(JH.GetJsonLangValue(e[n],"province_name"),e[n].province_code)),r.add(new Option(JH.GetJsonLangValue(e[n],"province_name"),e[n].province_code))},Gen_GraphLink:function(a,e,t,r,n){return'<a href="'+a+'" title="'+t+'" data-toggle="'+r+'" style="'+n+'">'+e+"</a>"},handlerSrvRain:function(a){srvTHF.SetRain_Setting(a.setting),srvMain.renderBoxRainTable(),"OK"==a.data.result&&(srvMain.Rain_genTable(a.data.data),srvMain.Rain_genMap(a.data.data))},renderBoxRainTable:function(){var a=srvTHF.GetRain_Sacle().slice(0);a.reverse();var e=$("#box-rain-table"),t=document.createElement("tr");for(e.append(t),i=0;i<a.length;i++){var r=document.createElement("td");r.bgColor=JH.GetJsonValue(a[i],"color"),r.innerText=JH.GetJsonValue(a[i],"operator")+JH.GetJsonValue(a[i],"term"),t.appendChild(r)}},Rain_render_name:function(a){var e=JH.GetJsonValue(a,"station.id"),t=JH.GetJsonValue(a,"geocode.province_code"),r=JH.GetJsonLangValue(a,"station.tele_station_name"),n=srvMain.translator._agency_name+JH.GetJsonLangValue(a,"agency.agency_name");return srvMain.Rain_GraphLink(e+"&province="+t,r,n)},Rain_render_location:function(a){var e=JH.GetJsonLangValue(a,"geocode.province_name"),t=JH.GetJsonLangValue(a,"geocode.amphoe_name"),r="";return""!=t&&(r+=srvMain.translator.short_amphoe+t+" "),""!=e&&(r+=srvMain.translator.short_province+e+" "),r},Rain_render_time:function(a){var e=JH.GetJsonValue(a,"rainfall_datetime");return e?JH.DateFormat(e,"YYYY-MM-DD HH:mm"):"-"},Rain_render_rain:function(a){var e=JH.GetJsonValue_Float(a,"rain_24h");return'<span class="badge" style="background:'+srvTHF.Rain_GetColor(e)+';color:#333;">'+numeral(JH.GetJsonValue(a,"rain_24h")).format("0,0.0")+"</span>"},Rain_genTable:function(a){srvMain.Rain_DataTable.clear().draw();for(i=0;i<a.length&&i<25;i++)srvMain.Rain_DataTable.row.add(a[i]);srvMain.Rain_DataTable.draw()},Rain_genMap:function(a){if(void 0!==srvMain.Rain_AllMarker&&srvMain.rain_map.removeLayer(srvMain.Rain_AllMarker),srvMain.Rain_AllMarker=new L.FeatureGroup,"object"!=typeof a||null==a)return!1;for(i=0;i<a.length;i++){var e=a[i],t=JH.GetJsonValue(e,"station.tele_station_lat"),r=JH.GetJsonValue(e,"station.tele_station_long");if(""!=t&&""!=r){var n=JH.GetJsonValue_Float(e,"rain_24h"),l=srvTHF.Rain_GetColorname(n);""!=l&&(m=srvTHF.Rain_Marker([t,r],e,l),m.bindPopup(srvMain.Rain_PopupText(e)).bindTooltip(srvMain.Rain_TooltipText(e)),m.on("popupopen",function(a){this.unbindTooltip()}),m.on("popupclose",function(a){this.bindTooltip(srvMain.Rain_TooltipText(this.options.properties))}),srvMain.Rain_AllMarker.addLayer(m))}}srvMain.Rain_AllMarker.addTo(srvMain.rain_map)},Rain_PopupText:function(a){return text=srvMain.Rain_TooltipText(a),text+=srvMain.Rain_GraphLink(JH.GetJsonValue(a,"station.id")+"&province="+JH.GetJsonValue(a,"geocode.province_code"),'<i class="fa fa-bar-chart" aria-hidden="true"></i>'),text},Rain_TooltipText:function(a){var e=srvMain.Rain_Table.find("th"),t=JH.GetJsonLangValue(a,"geocode.province_name",!0),r=JH.GetJsonLangValue(a,"geocode.amphoe_name",!0),n=JH.GetJsonLangValue(a,"geocode.tumbon_name",!0),i="";return""!=n&&(i+=srvMain.translator.short_tumbon+n+" "),""!=r&&(i+=srvMain.translator.short_amphoe+r+" "),""!=t&&(i+=srvMain.translator.short_province+t+" "),""!=i&&(i+="<br/>"),text=e[0].innerText+" : "+JH.GetJsonLangValue(a,"station.tele_station_name",!0)+"<br/>",text+=i,text+=e[2].innerText+" : "+srvMain.Rain_render_time(a)+"<br/>",text+=e[3].innerText+" : "+srvMain.Rain_render_rain(a)+"มม.<br/>",text+=srvMain.translator._agency_name+JH.GetJsonLangValue(a,"agency.agency_name",!0)+"<br/>",text},Rain_GraphLink:function(a,e,t){return srvMain.Gen_GraphLink(a,e,srvMain.translator.rain_graph_title_link+"\n"+t,"modal-rain")},handlerSrvRader:function(a){if("OK"!=a.data.result)return!1;var e=JH.GetJsonValue(a,"data.data"),t=$("#modal-radar-img"),r=$("#modal-radar-img-2"),n=document.createElement("div");for(i=0;i<e.length;i++){var l;if(i<=8)0==i&&((n=document.createElement("div")).className="row",t.append(n)),(l=document.createElement("div")).className="col-sm-4 radarimg";else 9==i&&((n=document.createElement("div")).className="row",r.append(n)),(l=document.createElement("div")).className="col-sm-2 radarimg";var o=JH.GetJsonValue(e[i],"media_path"),s=JH.GetJsonValue(e[i],"media_path_thumb");o?(o=IMAGE_URL+o+"&t="+JH.GetJsonValue(e[i],"media_datetime"),s=IMAGE_URL+s+"&t="+JH.GetJsonValue(e[i],"media_datetime")):o=DEFAULT_RADAR;var d=JH.DateFormat(e[i].media_datetime),u=JH.GetJsonValue(srvMain.translator.radar_name,"radar_"+JH.GetJsonValue(e[i],"radar_type"));u=u+"<br>"+d;var v=document.createElement("a");v.rel="radar",v.className="",v.href=o,v.dataset.lightbox="radar",v.dataset.title=u;var _=document.createElement("h5");_.innerHTML=u;var c=document.createElement("img");c.src=s,c.className="img-responsive",v.appendChild(c),l.appendChild(v),l.appendChild(_),n.appendChild(l)}},handlerSrvWaterLevel:function(a){if(srvTHF.SetWaterLevel_Setting(a.setting),srvMain.WaterLevel_genTableScale(),"OK"==a.data.result){srvMain.WaterLevel_Table_Data=a.data.data,srvMain.WaterLevel_genMap(a.data.data);var e=srvMain.GetWaterLevel20("desc");srvMain.WaterLevel_genTable(e)}},GetWaterLevel20:function(a){return"asc"==a?(rev=!1,data=srvMain.waterlevelCache.slice(-20)):"desc"==a?(rev=!0,data=srvMain.waterlevelCache.slice(0,20)):data=srvMain.waterlevelCache,JH.Sort(data,["basin.id","storage_percent"],[!1,rev]),data},WaterLevel_render_basin:function(a){return JH.GetJsonLangValue(a,"basin.basin_name")},WaterLevel_render_basinId:function(a){return JH.GetJsonLangValue(a,"basin.id")},WaterLevel_GetTAP:function(a){var e=JH.GetJsonLangValue(a,"geocode.tumbon_name"),t=JH.GetJsonLangValue(a,"geocode.amphoe_name"),r=JH.GetJsonLangValue(a,"geocode.province_name"),n="";return""!=e&&(n+=srvMain.translator.short_tumbon+e+" "),""!=t&&(n+=srvMain.translator.short_amphoe+t+" "),""!=r&&(n+=srvMain.translator.short_province+r+" "),n},WaterLevel_render_name:function(a){var e=srvMain.WaterLevel_GetTAP(a),t=JH.GetJsonValue(a,"geocode.province_code"),r=JH.GetJsonValue(a,"station.id"),n=JH.GetJsonValue(a,"station_type"),i=JH.GetJsonLangValue(a,"station.tele_station_name"),l=srvMain.translator._agency_name+JH.GetJsonLangValue(a,"agency.agency_name"),o=srvMain.WaterLevel_GraphLink(r+"&station_type="+n+"&province="+t,i+e,l),s=JH.GetJsonValue(a,"waterlevel_datetime");return moment().isSame(s,"date")||(o=$(o).css("color",srvTHF.GetWaterLevel_NotToday().colorname)[0].outerHTML),o},WaterLevel_render_datetime:function(a){var e=JH.GetJsonValue(a,"waterlevel_datetime");return srvTHF.DateFormat(e)},WaterLevel_render_msl:function(a){var e=JH.GetJsonValue(a,"waterlevel_msl"),t=srvTHF.NumFormat(e);return 999999==e&&(t=srvTHF.GetWaterLevel_NotToday().text),t},WaterLevel_render_storage:function(a){var e=JH.GetJsonValue(a,"storage_percent");return srvTHF.NumFormat(e)},WaterLevel_render_situation:function(a){var e=JH.GetJsonValue(a,"storage_percent");return srvTHF.WaterLevel_GetSituation(e,srvMain.translator)},WaterLevel_genTableScale:function(){var a=$("#waterlevel_table_scale"),e=srvTHF.GetWaterLevel_Scale();a.empty(),text="<td>"+srvMain.translator.waterlevel_scale_text+" (ม.รทก.)</td>";for(var t=e.length-1;t>=0;t--){var r=e[t],n=JH.GetJsonValue(r,"color"),i=JH.GetJsonValue(r,"text");i&&(text+='<td bgcolor="'+n+'">'+i+"</td>")}a.append(text)},WaterLevel_genMap:function(a){if(void 0!==srvMain.WaterLevel_AllMarker&&srvMain.waterlevel_map.removeLayer(srvMain.WaterLevel_AllMarker),srvMain.WaterLevel_AllMarker=new L.FeatureGroup,"object"!=typeof a||null==a)return!1;for(i=0;i<a.length;i++){var e=a[i],t=JH.GetJsonValue(e,"station"),r=JH.GetJsonValue(t,"tele_station_lat"),n=JH.GetJsonValue(t,"tele_station_long");if(""!=r&&""!=n){var l=JH.GetJsonValue(e,"storage_percent"),o=srvTHF.WaterLevel_GetColorName(l),s=JH.GetJsonValue(e,"waterlevel_datetime");moment().isSame(s,"date")||(o=srvTHF.GetWaterLevel_NotToday().colorname),""!=o&&(srvMain.waterlevelInit&&""!=l&&srvMain.waterlevelCache.push(e),m=srvTHF.WaterLevel_Marker([r,n],e,o),m.bindPopup(srvMain.WaterLevel_PopupText(e)).bindTooltip(srvMain.WaterLevel_TooltipText(e)),m.on("popupopen",function(a){this.unbindTooltip()}),m.on("popupclose",function(a){this.bindTooltip(srvMain.WaterLevel_TooltipText(this.options.properties))}),srvMain.WaterLevel_AllMarker.addLayer(m))}}srvMain.waterlevelInit=!1,srvMain.WaterLevel_AllMarker.addTo(srvMain.waterlevel_map)},WaterLevel_PopupText:function(a){var e=JH.GetJsonValue(a,"station"),t=JH.GetJsonValue(a,"geocode"),r=JH.GetJsonValue(e,"id"),n=JH.GetJsonValue(a,"station_type"),i=JH.GetJsonValue(t,"province_code"),l=srvMain.WaterLevel_TooltipText(a);return l+=srvMain.WaterLevel_GraphLink(r+"&station_type="+n+"&province="+i,'<i class="fa fa-bar-chart" aria-hidden="true"></i>')},WaterLevel_TooltipText:function(a){var e=JH.GetJsonValue(a,"station");JH.GetJsonValue(a,"geocode");tap=srvMain.WaterLevel_GetTAP(a),""!=tap&&(tap+="<br/>");var t=srvMain.WaterLevel_Table.find("th");return text=t[0].innerText+" : "+JH.GetJsonLangValue(e,"tele_station_name")+"<br/>",text+=tap,text+=t[2].innerText+" : "+srvTHF.NumFormat(JH.GetJsonValue(a,"waterlevel_msl"))+"<br/>",text+=t[4].innerText+" : "+srvTHF.WaterLevel_GetSituation(JH.GetJsonValue(a,"storage_percent"),srvMain.translator)+"<br/>",text},WaterLevel_genTable:function(a){srvMain.WaterLevel_DataTable.clear(),srvMain.WaterLevel_DataTable.rows.add(a),srvMain.WaterLevel_DataTable.draw()},WaterLevel_GraphLink:function(a,e,t){return srvMain.Gen_GraphLink(a,e,srvMain.translator.waterlevel_graph_title_link+"\n"+t,"modal-waterlevel")},handlerSrvDam:function(a){if(srvTHF.Set("dam",srvMain.translator.dam),srvTHF.SetDam_Scale(a.setting),srvMain.Dam_genTableScale(),"OK"==a.data.result){var e=a.data.data.slice();JH.Sort(e,"dam_date",!0,moment),0==e.length?$("#dam_max_date").text(JH.DateFormat(null,"YYYY-MM-DD")):$("#dam_max_date").text(JH.DateFormat(e[0].dam_date,"YYYY-MM-DD")),srvMain.Dam_genTable(a.data.data),srvMain.Dam_genMap(a.data.data)}},Dam_genTableScale:function(){var a=$("#dam_table_scale"),e=srvTHF.GetDam_Scale();a.empty(),text="<td>"+srvMain.translator.dam_scale_text+"</td>";for(var t=e.length-1;t>=0;t--){var r=e[t],n=JH.GetJsonValue(r,"color"),i=JH.GetJsonValue(r,"text");text+='<td bgcolor="'+n+'">'+i+"</td>"}a.append(text)},Dam_render_name:function(a){var e=JH.GetJsonValue(a.dam,"id"),t=srvMain.translator.dam+JH.GetJsonLangValue(a.dam,"dam_name",!0).replace("*","");return srvMain.Dam_GraphLink(e,t)},Dam_render_inflow:function(a){return srvTHF.NumFormat(JH.GetJsonValue(a,"dam_inflow"))},Dam_render_storage:function(a){var e=JH.GetJsonValue(a,"dam_storage");e=numeral(Math.round(e)).format("0,0");var t=JH.GetJsonValue(a,"dam_storage_percent");return t=Math.round(t),e+' (<font color="'+srvTHF.Dam_GetColor(t)+'">'+t+"%</font>)"},Dam_render_uses_water:function(a){var e=JH.GetJsonValue(a,"dam_uses_water_percent");return e=Math.round(e),srvTHF.NumFormat(JH.GetJsonValue(a,"dam_uses_water"))+" ("+e+"%)"},Dam_render_release:function(a){return srvTHF.NumFormat(JH.GetJsonValue(a,"dam_released"))},Dam_genTable:function(a){srvMain.Dam_DataTable.clear(),srvMain.Dam_DataTable.rows.add(a),srvMain.Dam_DataTable.draw(),srvTHF.Dam_SortData(a);var e=srvTHF.GetDam_Low_Text(),t=srvTHF.GetDam_High_Text(),r=srvTHF.GetDam_Setting_Low(),n=srvTHF.GetDam_Setting_High();e='<strong><font color="'+r.color+'">'+srvMain.translator[r.trans]+"</font> :</strong>"+e,t='<strong><font color="'+n.color+'">'+srvMain.translator[n.trans]+"</font> :</strong> "+t,$("#Dam_text").html(e+"<br/>"+t)},Dam_genMap:function(a){if(null==a)return!1;for(i=0;i<a.length;i++){var e=a[i],t=e.dam,r=JH.GetJsonValue(t,"dam_lat"),n=JH.GetJsonValue(t,"dam_long");if(""!=r||""!=n){var l=JH.GetJsonValue(e,"dam_storage_percent");m=srvTHF.Dam_Marker([r,n],e,srvTHF.Dam_GetColorname(l)),m.addTo(srvMain.dam_map),m.bindPopup(srvMain.Dam_PopupText(e)).bindTooltip(srvMain.Dam_TooltipText(e)),m.on("popupopen",function(a){this.unbindTooltip()}),m.on("popupclose",function(a){this.bindTooltip(srvMain.Dam_TooltipText(this.options.properties))})}}},Dam_PopupText:function(a){return text=srvMain.Dam_TooltipText(a),text+=srvMain.Dam_GraphLink(JH.GetJsonValue(a.dam,"id"),'<i class="fa fa-bar-chart" aria-hidden="true"></i>'),text},Dam_TooltipText:function(a){var e=srvMain.Dam_Table.find("th");return text=e[0].innerText+" : "+srvMain.Dam_render_name(a)+"<br/>",text+=e[1].innerText+" : "+srvMain.Dam_render_inflow(a)+"<br/>",text+=e[2].innerText+" : "+srvMain.Dam_render_storage(a)+"<br/>",text+=e[3].innerText+" : "+srvMain.Dam_render_uses_water(a)+"<br/>",text+=e[4].innerText+" : "+srvMain.Dam_render_release(a)+"<br/>",text},Dam_GraphLink:function(a,e){return srvMain.Gen_GraphLink(a,e,srvMain.translator.dam_graph_title_link,"modal-dam")},handlerSrvWaterQuality:function(a){srvTHF.SetWaterQuality_Setting(a.setting),"OK"==a.data.result&&(srvMain.WaterQuality_genTable(JH.GetJsonValue(a.data,"data")),srvMain.WaterQuality_genMap(JH.GetJsonValue(a.data,"data")))},WaterQuality_genTable:function(a){srvMain.WaterQuality_DataTable.clear(),srvMain.WaterQuality_DataTable.rows.add(a),srvMain.WaterQuality_DataTable.draw()},WaterQuality_render_name:function(a){var e=JH.GetJsonLangValue(a,"waterquality_station.waterquality_station_name").replace("สถานี",""),t=JH.GetJsonValue(JH.GetJsonValue(a,"waterquality_station"),"id"),r="";moment().isSame(JH.GetJsonValue(a,"waterquality_datetime"),"date")||(r="color: "+srvTHF.GetWaterQuality_not_today().color);var n=srvMain.translator._agency_name+JH.GetJsonLangValue(a,"waterquality_station.agency_name");return srvMain.WaterQuality_GraphLink(t+"&province="+JH.GetJsonValue(a.waterquality_station,"province_code"),e,r,n)},WaterQuality_render_province:function(a){return JH.GetJsonLangValue(JH.GetJsonValue(a,"waterquality_station"),"province_name")},WaterQuality_render_datetime:function(a){return srvTHF.DateFormat(JH.GetJsonValue(a,"waterquality_datetime"))},WaterQuality_render_ph:function(a){var e=srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_ph")),t="";return""!=e&&(t=srvTHF.WaterQuality_GetColor_ph(JH.GetJsonValue_Float(a,"waterquality_ph"))),'<font color="'+t+'">'+e+"</font>"},WaterQuality_render_salinity:function(a){var e=srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_salinity")),t="";return""!=e&&(t=srvTHF.WaterQuality_GetColor_salinity(JH.GetJsonValue_Float(a,"waterquality_salinity"))),'<font color="'+t+'">'+e+"</font>"},WaterQuality_render_turbid:function(a){var e=srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_turbid")),t="";return""!=e&&(t=srvTHF.WaterQuality_GetColor_turbid(JH.GetJsonValue_Float(a,"waterquality_turbid"))),'<font color="'+t+'">'+e+"</font>"},WaterQuality_render_conductivity:function(a){return srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_conductivity"))},WaterQuality_render_tds:function(a){var e=srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_tds")),t="";return""!=e&&(t=srvTHF.WaterQuality_GetColor_tds(JH.GetJsonValue_Float(a,"waterquality_tds"))),'<font color="'+t+'">'+e+"</font>"},WaterQuality_render_chlorophyll:function(a){return srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_chlorophyll"))},WaterQuality_render_do:function(a){var e=srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_do")),t="";return""!=e&&(t=srvTHF.WaterQuality_GetColor_do(JH.GetJsonValue_Float(a,"waterquality_do"))),'<font color="'+t+'">'+e+"</font>"},WaterQuality_render_temp:function(a){return srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_temp"))},WaterQuality_render_depth:function(a){return srvTHF.NumFormat(JH.GetJsonValue(a,"waterquality_depth"))},WaterQuality_createdRow:function(a,e){var t=JH.GetJsonValue(e,"waterquality_ph"),r=JH.GetJsonValue(e,"waterquality_salinity"),n=JH.GetJsonValue(e,"waterquality_turbid"),i=JH.GetJsonValue(e,"waterquality_ec"),l=JH.GetJsonValue(e,"waterquality_tds"),o=JH.GetJsonValue(e,"waterquality_chlorophyll"),s=JH.GetJsonValue(e,"waterquality_do"),d=JH.GetJsonValue(e,"waterquality_temp");t||r||n||i||l||o||s||d||srvMain.WaterQuality_DataTable.row(a).remove().draw(!1)},WaterQuality_genMap:function(a){if(null==a)return!1;for(i=0;i<a.length;i++){var e=a[i],t=JH.GetJsonValue(e,"waterquality_station"),r=JH.GetJsonValue(t,"waterquality_station_lat"),n=JH.GetJsonValue(t,"waterquality_station_long");if(""!=r&&""!=n){var l=srvTHF.WaterQuality_GetMarkerColor(e);l==srvTHF.GetWaterQuality_Default().color&&(l=srvTHF.GetWaterQuality_Default().colorname),moment().isSame(JH.GetJsonValue(e,"waterquality_datetime"),"date")||(l=srvTHF.GetWaterQuality_not_today().colorname),m=srvTHF.WaterQuality_Marker([r,n],e,l),m.addTo(srvMain.waterquality_map),m.bindPopup(srvMain.WaterQuality_PopupText(e)).bindTooltip(srvMain.WaterQuality_TooltipText(e)),m.on("popupopen",function(a){this.unbindTooltip()}),m.on("popupclose",function(a){this.bindTooltip(srvMain.WaterQuality_TooltipText(this.options.properties))})}}},WaterQuality_PopupText:function(a){return text=srvMain.WaterQuality_TooltipText(a),text+=srvMain.WaterQuality_GraphLink(JH.GetJsonValue(JH.GetJsonValue(a,"waterquality_station"),"id")+"&province="+JH.GetJsonValue(a.waterquality_station,"province_code"),'<i class="fa fa-bar-chart" aria-hidden="true"></i>'),text},WaterQuality_TooltipText:function(a){var e=srvMain.WaterQuality_Table.find("th"),t=JH.GetJsonValue(a,"waterquality_station"),r='<font color=""></font>',n=JH.GetJsonLangValue(t,"province_name"),i=JH.GetJsonLangValue(t,"amphoe_name"),l=JH.GetJsonLangValue(t,"tumbon_name"),o="";""!=l&&(o+=srvMain.translator.short_tumbon+l+" "),""!=i&&(o+=srvMain.translator.short_amphoe+i+" "),""!=n&&(o+=srvMain.translator.short_province+n+" "),o+="<br/>";var s=srvMain.WaterQuality_render_salinity(a);s!=r&&(s=e[3].innerText+" : "+s+"<br/>");var d=srvMain.WaterQuality_render_do(a);d!=r&&(d=e[4].innerText+" : "+d+"<br/>");var u=srvMain.WaterQuality_render_ph(a);u!=r&&(u=e[5].innerText+" : "+u+"<br/>");var v=srvMain.WaterQuality_render_turbid(a);v!=r&&(v=e[6].innerText+" : "+v+"<br/>");var _=srvMain.WaterQuality_render_conductivity(a);""!=_&&(_=e[7].innerText+" : "+_+"<br/>");var c=srvMain.WaterQuality_render_tds(a);c!=r&&(c=e[8].innerText+" : "+c+"<br/>");var m=srvMain.WaterQuality_render_chlorophyll(a);return""!=m&&(m=e[9].innerText+" : "+m+"<br/>"),text=e[0].innerText+" : "+JH.GetJsonLangValue(t,"waterquality_station_name").replace("สถานี","")+"<br/>",text+=o,text+=s,text+=d,text+=u,text+=v,text+=_,text+=c,text+=m,text+=srvMain.translator._agency_name+JH.GetJsonLangValue(t,"agency_name")+"<br/>",text},WaterQuality_GraphLink:function(a,e,t,r){return srvMain.Gen_GraphLink(a,e,srvMain.translator.waterquality_graph_title_link+"\n"+r,"modal-waterquality",t)},handlerSrvStorm:function(a){if(srvTHF.SetStorm_Setting(JH.GetJsonValue(a,"setting")),srvTHF.renderModalStormTable(),"OK"!=a.data.result)return!1;var e=JH.GetJsonValue(a,"data.data"),t=JH.GetJsonValue(e,"college");for(i=0;i<t.length;i++){if(""!=(n=JH.GetJsonValue(t[i],"filename")))if(1==$("#box-storm-img-"+n[0]).length)(l=document.createElement("img")).src=IMAGE_URL+JH.GetJsonValue(t[i],"media_path"),l.className="img-responsive center-block",$("#box-storm-img-"+n[0]).append(l)}var r=JH.GetJsonValue(e,"kochi");for(i=0;i<r.length;i++){var n,l;if(""!=(n=JH.GetJsonValue(r[i],"filename")))(l=document.createElement("img")).src=IMAGE_URL+JH.GetJsonValue(r[i],"media_path"),l.className="img-responsive center-block",$("#box-storm-img-himawari").append(l)}},handlerSrvPreRain:function(a){if("OK"!=a.data.result)return!1;var e,t=JH.GetJsonValue(a,"data.data"),r=($("#box-predict_rain-img"),$("#modal-prerain-carousel")),n=$("#modal-prerain-carousel").find("ol.carousel-indicators"),l=$("#modal-prerain-carousel").find("div.carousel-inner");if(0==t.length)return r.find("a").hide(),r.find("h6").text(srvMain.translator.no_data),!1;for(r.find("a").show(),i=0;i<t.length;i++){var o=t[i],s=JH.GetJsonValue(o,"filename"),d=JH.GetJsonValue(t[i],"media_path")+"&t="+JH.GetJsonValue(t[i],"media_datetime"),u="",v="",_=document.createElement("img"),c=0==i?"active":"";s.search("d03")+1?(e=$("#box-predict_rain-img1"),u=JH.GetJsonValue(t[i],"media_path"),u+="&t="+JH.GetJsonValue(t[i],"media_datetime"),_.style.width="320px",v='<div class="item '+c+'"> <img class="center-block" usemap="#map-area-3" src="'+IMAGE_URL+d+'" > </div>'):(e=$("#box-predict_rain-img2"),u=JH.GetJsonValue(t[i],"media_path_thumb"),u+="&t="+JH.GetJsonValue(t[i],"media_datetime"),v='<div class="item"> <img class="center-block" usemap="#map-area-9" src="'+IMAGE_URL+d+'" > </div>');var m=document.createElement("a");m.rel="predict_rain",m.className="col-md-4 fancybox img-thumbnail",m.href="javascript:void(0);",_.src=IMAGE_URL+u,_.dataset.toggle="modal",_.dataset.target="#modal-prerain",_.dataset.slideTo=i,m.appendChild(_),e.append(m),n.append('<li data-target="#modal-prerain-carousel" data-slide-to="'+i+'" class="'+c+'"></li>'),l.append(v)}l.find("img").maphilight()},handlerSrvPreRainTH:function(a){if("OK"!=a.data.result)return!1;var e,t=JH.GetJsonValue(a,"data.data"),r=($("#box-predict_rain-img"),$("#modal-prerain-carousel")),n=r.find("ol.carousel-indicators"),l=r.find("div.carousel-inner");if(0==t.length)return r.find("a").hide(),r.find("h6").text(srvMain.translator.no_data),!1;for(r.find("a").show(),i=0;i<t.length;i++){var o,s=t[i],d=(JH.GetJsonValue(s,"filename"),JH.GetJsonValue(t[i],"media_path")+"&t="+JH.GetJsonValue(t[i],"media_datetime")),u="",v=document.createElement("img"),_=0==i?"active":"";e=$("#box-predict_rain-img1"),u=JH.GetJsonValue(t[i],"media_path_thumb"),u+="&t="+JH.GetJsonValue(t[i],"media_datetime"),v.style.width="200px",o='<div class="item '+_+'"> <img class="center-block" usemap="#map-area-3" src="'+IMAGE_URL+d+'" > </div>';var c=document.createElement("a");c.rel="predict_rain",c.className="col-md-4 fancybox",c.href="javascript:void(0);",v.src=IMAGE_URL+u,v.dataset.toggle="modal",v.dataset.target="#modal-prerain",v.dataset.slideTo=i,v.dataset.tab=0,v.className="img-responsive img-thumbnail",c.appendChild(v),e.append(c),n.append('<li data-target="#modal-prerain-carousel" data-slide-to="'+i+'" class="'+_+'"></li>'),l.append(o)}l.find("img").maphilight()},handlerSrvPreRainSea:function(a){if("OK"!=a.data.result)return!1;var e,t=JH.GetJsonValue(a,"data.data"),r=($("#box-predict_rain-img"),$("#modal-prerain-sea-carousel")),n=r.find("ol.carousel-indicators"),l=r.find("div.carousel-inner");if(0==t.length)return r.find("a").hide(),r.find("h6").text(srvMain.translator.no_data),!1;for(r.find("a").show(),showImg=["d02_day04.jpg","d02_day05.jpg","d02_day06.jpg","d02_day07.jpg"],i=0;i<t.length;i++){var o,s=t[i],d=JH.GetJsonValue(s,"filename"),u=JH.GetJsonValue(t[i],"media_path")+"&t="+JH.GetJsonValue(t[i],"media_datetime"),v="",_=document.createElement("img"),c=0==i?"active":"";e=$("#box-predict_rain-img2"),v=JH.GetJsonValue(t[i],"media_path_thumb"),v+="&t="+JH.GetJsonValue(t[i],"media_datetime"),o='<div class="item '+c+'"> <img class="center-block" usemap="#map-area-9" src="'+IMAGE_URL+u+'" > </div>';var m=document.createElement("a");m.rel="predict_rain",m.className="col-md-3 fancybox",m.href="javascript:void(0);",_.style.width="100%",_.style.marginTop="15px",_.src=IMAGE_URL+v,_.dataset.toggle="modal",_.dataset.target="#modal-prerain",_.dataset.slideTo=i,_.dataset.tab=1,_.className="img-responsive img-thumbnail",m.appendChild(_),showImg.indexOf(d)>-1&&e.append(m),n.append('<li data-target="#modal-prerain-sea-carousel" data-slide-to="'+i+'" class="'+c+'"></li>'),l.append(o)}l.find("img").maphilight()},handlerSrvPreRainSoutheastAsia:function(a){if("OK"!=a.data.result)return!1;var e=JH.GetJsonValue(a,"data.data"),t=($("#box-predict_rain-img"),$("#modal-prerain-southeast-asia-carousel")),r=$("#modal-prerain-southeast-asia-carousel").find("ol.carousel-indicators"),n=$("#modal-prerain-southeast-asia-carousel").find("div.carousel-inner");if(0==e.length)return t.find("a").hide(),t.find("h6").text(srvMain.translator.no_data),!1;for(t.find("a").show(),i=0;i<e.length;i++){var l,o=e[i],s=(JH.GetJsonValue(o,"filename"),JH.GetJsonValue(e[i],"media_path")+"&t="+JH.GetJsonValue(e[i],"media_datetime")),d=(document.createElement("img"),0==i?"active":"");$("#box-predict_rain-img1"),JH.GetJsonValue(e[i],"media_path"),"&t="+JH.GetJsonValue(e[i],"media_datetime"),l='<div class="item '+d+'"> <img class="center-block" usemap="#map-area-9" src="'+IMAGE_URL+s+'" > </div>',r.append('<li data-target="#modal-prerain-carousel" data-slide-to="'+i+'" class="'+d+'"></li>'),n.append(l)}n.find("img").maphilight()},handlerSrvPreRainAsia:function(a){if("OK"!=a.data.result)return!1;var e=JH.GetJsonValue(a,"data.data"),t=($("#box-predict_rain-img"),$("#modal-prerain-asia-carousel")),r=t.find("ol.carousel-indicators"),n=t.find("div.carousel-inner");if(0==e.length)return t.find("a").hide(),t.find("h6").text(srvMain.translator.no_data),!1;for(t.find("a").show(),i=0;i<e.length;i++){var l,o=e[i],s=(JH.GetJsonValue(o,"filename"),JH.GetJsonValue(e[i],"media_path")+"&t="+JH.GetJsonValue(e[i],"media_datetime")),d=(document.createElement("img"),0==i?"active":"");$("#box-predict_rain-img1"),JH.GetJsonValue(e[i],"media_path"),"&t="+JH.GetJsonValue(e[i],"media_datetime"),l='<div class="item '+d+'"> <img class="center-block" usemap="#map-are-27" src="'+IMAGE_URL+s+'" > </div>',r.append('<li data-target="#modal-prerain-carousel" data-slide-to="'+i+'" class="'+d+'"></li>'),n.append(l)}n.find("img").maphilight()},handlerSrvPreRainBsin:function(a){if("OK"!=a.data.result)return!1;var e=JH.GetJsonValue(a,"data.data"),t=($("#box-predict_rain-img"),$("#modal-prerain-basin-carousel")),r=t.find("ol.carousel-indicators"),n=t.find("div.carousel-inner");if(0==e.length)return t.find("a").hide(),t.find("h6").text(srvMain.translator.no_data),!1;for(t.find("a").show(),i=0;i<e.length;i++){var l,o=e[i],s=(JH.GetJsonValue(o,"filename"),JH.GetJsonValue(e[i],"media_path")+"&t="+JH.GetJsonValue(e[i],"media_datetime")),d=(document.createElement("img"),0==i?"active":"");$("#box-predict_rain-img1"),JH.GetJsonValue(e[i],"media_path"),"&t="+JH.GetJsonValue(e[i],"media_datetime"),l='<div class="item '+d+'"> <img class="center-block" usemap="#map-area-basin" src="'+IMAGE_URL+s+'" > </div>',r.append('<li data-target="#modal-prerain-carousel" data-slide-to="'+i+'" class="'+d+'"></li>'),n.append(l)}n.find("img").maphilight()},handlerSrvPreRainAnimation:function(a){if("OK"!=a.result)return!1;var e=JH.GetJsonValue(a,"data");for(i=0;i<e.length;i++){var t=e[i],r='<video width="100%"controls>';r+='<source src="'+(IMAGE_URL+JH.GetJsonValue(t,"media_path")+"&t="+JH.GetJsonValue(e[i],"media_datetime"))+'" type="video/mp4">',r+="</video>",$("#animation_0"+(i+1)).html(r)}},handlerSrvWave:function(a){if("OK"!=a.data.result)return!1;var e,t=JH.GetJsonValue(a,"data.data"),r=($("#box-predict_wave-img"),$("#modal-prewave-carousel").find("ol.carousel-indicators")),n=$("#modal-prewave-carousel").find("div.carousel-inner");for(i=0;i<t.length;i++){var l=t[i],o=(JH.GetJsonValue(l,"filename"),JH.GetJsonValue(t[i],"media_path")+"&t="+JH.GetJsonValue(t[i],"media_datetime")),s="",d="",u=document.createElement("img"),v=0==i?"active":"";if(i<=2){var _=document.createElement("a");e=$("#box-predict_wave-img1"),s=JH.GetJsonValue(t[i],"media_path"),s+="&t="+JH.GetJsonValue(t[i],"media_datetime"),u.style.width="320px",d='<div class="item '+v+'"> <img class="center-block" src="'+IMAGE_URL+o+'" > </div>'}else e=$("#box-predict_wave-img2"),s=JH.GetJsonValue(t[i],"media_path"),s+="&t="+JH.GetJsonValue(t[i],"media_datetime"),d='<div class="item"> <img class="center-block" src="'+IMAGE_URL+o+'" > </div>';(_=document.createElement("a")).rel="predict_wave",_.className="fancybox",_.href="javascript:void(0);",u.src=IMAGE_URL+s,u.dataset.toggle="modal",u.dataset.target="#modal-prewave",u.dataset.slideTo=i,u.className="img-thumbnail",_.appendChild(u),e.append(_),r.append('<li data-target="#modal-prewave-carousel" data-slide-to="'+i+'" class="'+v+'"></li>'),n.append(d)}},handlerSrvWaveAnimation:function(a){if("OK"!=a.result)return!1;var e=JH.GetJsonValue(a,"data"),t=$("#box-prewave_animation").find(".box-body");for(i=0;i<e.length;i++){var r=document.createElement("img");r.className="img-responsive",r.src=IMAGE_URL+JH.GetJsonValue(e[i],"media_path")+"&t="+JH.GetJsonValue(e[i],"media_datetime"),t.append(r)}},handlerSrvWarning:function(a){var e=JH.GetJsonValue(a,"setting");srvTHF.SetWarning_Setting(e),srvMain.handlerWarningRain(JH.GetJsonValue(a,"temp_data")),srvMain.handlerWarningPreRain(JH.GetJsonValue(a,"temp_data2")),WarningBoxRiskRain(),WarningBoxRiskDrought(JH.GetJsonValue(a,"drought")),WarningBoxRiskFlood(JH.GetJsonValue(a,"flood"))},handlerWarningRain:function(a){if("OK"==JH.GetJsonValue(a,"result")){var e=JH.GetJsonValue(a,"data");for(i=0;i<e.length;i++){var t=e[i],r=JH.GetJsonValue_Float(t,"rain"),n=JH.GetJsonValue_Float(t,"rain1h"),l=JH.GetJsonValue(t,"warning_zone");if(""!=l){var o=srvTHF.Rain_GetRuleLevel(l,r,"rain24h"),s=srvTHF.Rain_GetRuleLevel(l,n,"rain1h"),d=Math.max(o,s),u=JH.GetJsonLangValue(t,"province_name");rain_cacheProvinceLevel(u,d)}}}}},rain_cacheProvinceLevel=function(a,e){if(0==arguments.length)return JH.GetJsonValue(srvMain,"cache.rain_province");void 0===srvMain.cache.rain_province&&(srvMain.cache.rain_province={});var t=Math.max(e,JH.GetJsonValue_Float(srvMain,"cache.rain_province."+a));srvMain.cache.rain_province[a]=t};srvMain.handlerWarningPreRain=function(a){if("OK"!=JH.GetJsonValue(a,"result"))return!1;var e=JH.GetJsonValue(a,"data");for(i=0;i<e.length;i++){var t=e[i],r=JH.GetJsonLangValue(t,"province_name");prerain_cache(r)}};var prerain_cache=function(a){if(0==arguments.length)return JH.GetJsonValue(srvMain,"cache.prerain_province");void 0===srvMain.cache.prerain_province&&(srvMain.cache.prerain_province=[]),srvMain.cache.prerain_province.push(a)},WarningBoxRiskRain=function(){var a=rain_cacheProvinceLevel(),e=prerain_cache(),t="";for(i=0;i<e.length;i++){var r=e[i];0!=JH.GetJsonValue_Int(a,r)&&(""!=t&&(t+=","),t+=r)}$("#box-risk-rain").append(t)},WarningBoxRiskDrought=function(a){if("OK"!=JH.GetJsonValue(a,"result"))return!1;var e=JH.GetJsonValue(a,"data"),t="";for(i=0;i<e.length;i++){var r=e[i];0!=i&&(t+=", "),t+=JH.GetJsonLangValue(r,"province_name")}$("#box-risk-drought").append(t)},WarningBoxRiskFlood=function(a){if("OK"!=JH.GetJsonValue(a,"result"))return!1;var e=JH.GetJsonValue(a,"data"),t="";for(i=0;i<e.length;i++){var r=e[i];0!=i&&(t+=", "),t+=JH.GetJsonLangValue(r,"province_name")}$("#box-risk-flood").append(t)};